<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>二次方程式の解と係数の関係</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .question { margin-bottom: 20px; }
    .options { margin-top: 10px; }
    .options input { margin-right: 20px; padding:40px;}
    .correct { color: green; }
    .incorrect { color: red; }
    button { margin-top: 30px; }
input {
    width: 80px;  /* 幅の調整 */
    height: 40px;  /* 高さの調整 */
    padding: 5px;
  }
 button {
    width: 200px;  /* ボタンの幅 */
    height: 40px;  /* ボタンの高さ */
    font-size: 16px;  /* 文字の大きさ */
    padding: 10px;  /* 内側の余白 */
  }
  </style>
</head>
<body>
<h1>二次方程式の解と係数の関係</h1>
<div id="quiz"></div>
<button type="button" onclick="checkAnswer()">答え合わせ</button>
<button type="button" onclick="generateQuiz()">再出題</button>
<div id="feedback"></div>

<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
function getRandomInt(min, max, excludeZero=false) {
  let v;
  do { v = Math.floor(Math.random()*(max-min+1)) + min; }
  while ((excludeZero && v===0));
  return v;
}

function formatNumber(n) {
  return n === 1 ? '' : (n === -1 ? '-' : n);
}

function generateEquationString(a, b) {
  let equation = 'x^2';

  // xの項（a, bの符号に応じて表示）
  if (a === 1) {
    equation += `+x`;
  } else if (a === -1) {
    equation += `-x`;
  } else if (a > 0) {
    equation += `+${a}x`;
  } else if (a < 0) {
    equation += `${a}x`;
  }

  // 定数項（bの符号に応じて表示）
  if (b > 0) {
    equation += ` + ${b}`;
  } else if (b < 0) {
    equation += ` ${b}`;
  }

  equation += ` = 0`;

  // 重複した + と - の修正
  equation = equation.replace(/\+\-/g, "-").replace(/\-\+/g, "-").replace(/\+\+/g, "+");

  return equation;
}

function generateQuiz() {
  document.getElementById('feedback').textContent = '';
  let a, b;
  do {
    a = getRandomInt(-6, 6, true);
    b = getRandomInt(-6, 6, true);
  } while (a === 0 || b === 0 || a*a - 4*b === 0);

  const quizDiv = document.getElementById('quiz');
  const eq = generateEquationString(a, b);
  quizDiv.innerHTML = `
    <div class="question">次の二次方程式 \\(${eq}\\) の解 α、β について、次の値を求めよ。</div>
    <div>
      \\(α + β = \\)
      <input type="text" id="sum" placeholder="答えを入力">
    </div>
<br>
    <div>
      \\(αβ = \\)
      <input type="text" id="product" placeholder="答えを入力">
    </div>
<br>
    <div>
      \\(α^2 + β^2 = \\)
      <input type="text" id="squareSum" placeholder="答えを入力">
    </div>
  `;

  const alphaBetaSum = -a; // α + β = -a
  const alphaBetaProd = b; // αβ = b
  const alphaBetaSquareSum = a*a - 2*b; // α² + β² = a² - 2b

  // 正解を保存
  const correctAnswers = {
    sum: alphaBetaSum,
    product: alphaBetaProd,
    squareSum: alphaBetaSquareSum
  };

  // グローバル変数に正解を保存
  window.correctAnswers = correctAnswers;

  // MathJaxを利用して数式を表示
  MathJax.typeset();
}

function checkAnswer() {
  const sum = parseFloat(document.getElementById('sum').value);
  const product = parseFloat(document.getElementById('product').value);
  const squareSum = parseFloat(document.getElementById('squareSum').value);

  const feedback = document.getElementById('feedback');
  
  let correctCount = 0;

  if (sum === window.correctAnswers.sum) correctCount++;
  if (product === window.correctAnswers.product) correctCount++;
  if (squareSum === window.correctAnswers.squareSum) correctCount++;

  if (correctCount === 3) {
    feedback.innerHTML = `<span class="correct">すべて正解！</span>`;
  } else {
    feedback.innerHTML = `
      <span class="incorrect">不正解！もう一度確認してください。</span><br>
      正解: α + β = ${window.correctAnswers.sum}, αβ = ${window.correctAnswers.product}, α² + β² = ${window.correctAnswers.squareSum}
    `;
  }
}

generateQuiz();
</script>
</body>
</html>
