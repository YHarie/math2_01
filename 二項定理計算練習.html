<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>二項定理の計算問題</title>
  <style>
   body {
  font-family: sans-serif;
  padding: 4vw;
  font-size: 4vw;
  text-align: left;
}

.question {
  margin-bottom: 4vw;
}

input {
  width: 20vw;
  height: 8vw;
  padding: 1vw;
  font-size: 4vw;
  margin-left: 2vw;
}

button {
  width: 40vw;
  height: 10vw;
  font-size: 4vw;
  padding: 2vw;
  margin-right: 2vw;
}

.correct {
  color: green;
}

.incorrect {
  color: red;
}

.mj-tex {
  text-align: left;
  display: block;
}

/* PC向けのスタイル調整 */
@media (min-width: 768px) {
  body {
    padding: 20px;
    font-size: 18px;
  }

  .question {
    margin-bottom: 20px;
  }

  input {
    width: 100px;
    height: 40px;
    padding: 5px;
    font-size: 16px;
  }

  button {
    width: 200px;
    height: 40px;
    font-size: 16px;
    padding: 10px;
  }
}

  </style>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>
<body>

<h1>二項定理の計算問題</h1>
<div id="score"></div>
<form id="quizForm"></form>
<button onclick="checkAnswers()">答え合わせ</button>
<button onclick="generateProblems()">再出題</button>

<script>
const quizForm = document.getElementById("quizForm");
const scoreDisplay = document.getElementById("score");
let problems = [];

function getRandomInt(min, max, excludeZero = false) {
  let value;
  do {
    value = Math.floor(Math.random() * (max - min + 1)) + min;
  } while (excludeZero && value === 0);
  return value;
}

function binomialCoeff(n, k) {
  const fact = (num) => num <= 1 ? 1 : num * fact(num - 1);
  return fact(n) / (fact(k) * fact(n - k));
}

function toTexComplex(a, b) {
  const re = a !== 0 ? a.toString() : "";
  let im = "";
  if (b === 1) im = "+i";
  else if (b === -1) im = "-i";
  else if (b > 0) im = "+" + b + "i";
  else if (b < 0) im = b + "i";
  return re + im || "0";
}

function generateProblems() {
  quizForm.innerHTML = "";
  scoreDisplay.textContent = "";
  problems = [];

  // 問題1: (x + a)^n
  {
    const a = getRandomInt(-2, 2, true);  // a: -2 ～ 2（0除外）
    const n = getRandomInt(5, 8);
    const r = getRandomInt(n - 3, n - 1);
    const coeff = binomialCoeff(n, r) * Math.pow(a, n - r);
    const tex = `(x ${a >= 0 ? '+' : ''}${a})^{${n}}`;
    const target = (r === 1) ? `x` : `x^{${r}}`;
    problems.push({ tex, target, answer: coeff });
  }

  // 問題2: (ax + b)^n
  {
    const a = getRandomInt(2, 3); // a: 2 ～ 3
    let b;
    do {
      b = getRandomInt(-3, 3, true); // b: -3 ～ 3（0除外）
    } while (Math.abs(a) % Math.abs(b) === 0);
    const n = getRandomInt(3, 6);
    const r = getRandomInt(n - 3, n - 1);
    const coeff = binomialCoeff(n, r) * Math.pow(a, r) * Math.pow(b, n - r);
    const tex = `(${a === 1 ? '' : a}x ${b >= 0 ? '+' : ''}${b})^{${n}}`;
    const target = (r === 1) ? `x` : `x^{${r}}`;
    problems.push({ tex, target, answer: coeff });
  }

  // 問題3: (ax + by)^n
  {
    const a = getRandomInt(2, 3); // a: 2 ～ 3
    let b;
    do {
      b = getRandomInt(-3, 3, true); // b: -3 ～ 3（0除外）
    } while (Math.abs(a) % Math.abs(b) === 0);
    const n = getRandomInt(3, 6);
    const r = getRandomInt(n - 3, n - 1);
    const s = n - r;
    const coeff = binomialCoeff(n, r) * Math.pow(a, r) * Math.pow(b, s);
    let yPart = '';
    if (b === 1) yPart = '+ y';
    else if (b === -1) yPart = '- y';
    else yPart = `${b > 0 ? '+' : ''}${b}y`;
    const tex = `(${a === 1 ? '' : a}x ${yPart})^{${n}}`;
    const xPart = (r === 1) ? 'x' : `x^{${r}}`;
    const yPartT = (s === 1) ? 'y' : `y^{${s}}`;
    const target = `${xPart} ${yPartT}`;
    problems.push({ tex, target, answer: coeff });
  }

  problems.forEach((p, i) => {
    const div = document.createElement("div");
    div.className = "question";
    div.innerHTML = `
      <div><strong>問${i + 1}.</strong> \\( ${p.tex} \\) の展開における \\( ${p.target} \\) の係数を求めよ。</div>
      <input type="number" step="1" id="input${i}" placeholder="係数を入力">
      <span id="result${i}"></span>
    `;
    quizForm.appendChild(div);
  });

  MathJax.typeset();
}

function checkAnswers() {
  let correct = 0;
  problems.forEach((p, i) => {
    const input = parseInt(document.getElementById(`input${i}`).value);
    const result = document.getElementById(`result${i}`);
    if (input === p.answer) {
      result.innerHTML = `<span class="correct">← 正解！</span>`;
      correct++;
    } else {
      result.innerHTML = `<span class="incorrect">← 不正解（正: ${p.answer}）</span>`;
    }
  });
  scoreDisplay.textContent = `スコア：${correct} / ${problems.length} 正解`;
}

generateProblems();
</script>

</body>
</html>
