<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>複素数の四則演算練習</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .question { margin-bottom: 1em; }
    .answer { margin-left: 1em; color: green; font-weight: bold; }
    button { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>複素数の四則演算練習</h1>
  <div id="quiz"></div>
  <button onclick="generateProblems()">再出題</button>

  <script>
    function getRandomInt(min, max, excludeZero = false) {
      let n;
      do {
        n = Math.floor(Math.random() * (max - min + 1)) + min;
      } while (excludeZero && n === 0);
      return n;
    }

    function formatComplex(a, b) {
      let real = a !== 0 ? a.toString() : "";
      let imag = b !== 0 ? (b > 0 ? (a !== 0 ? "+" : "") + (b === 1 ? "i" : b + "i") : (b === -1 ? "-i" : b + "i")) : "";
      return (real + imag) || "0";
    }

    function addComplex(a, b, c, d) {
      return [a + c, b + d];
    }

    function subtractComplex(a, b, c, d) {
      return [a - c, b - d];
    }

    function multiplyComplex(a, b, c, d) {
      return [a * c - b * d, a * d + b * c];
    }

    function divideComplex(a, b, c, d) {
      const denominator = c * c + d * d;
      const real = Math.floor((a * c + b * d) / denominator);
      const imag = Math.floor((b * c - a * d) / denominator);
      return [real, imag];
    }

    function generateProblems() {
      const quizDiv = document.getElementById("quiz");
      quizDiv.innerHTML = "";

      const problems = [];
      for (let i = 0; i < 2; i++) {
        let a = getRandomInt(-5, 5, true);
        let b = getRandomInt(-5, 5, true);
        let c = getRandomInt(-5, 5, true);
        let d = getRandomInt(-5, 5, true);
        problems.push({ a, b, c, d, op: i === 0 ? "+" : "-" });
      }
      for (let i = 0; i < 2; i++) {
        let a = getRandomInt(-5, 5, true);
        let b = getRandomInt(-5, 5, true);
        let c = getRandomInt(-5, 5, true);
        let d = getRandomInt(-5, 5, true);
        problems.push({ a, b, c, d, op: "×" });
      }
      for (let i = 0; i < 1; i++) {
        let a = getRa
