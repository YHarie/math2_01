<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>高次方程式の問題</title>
  <style>
    body { font-family: sans-serif; padding: 20px; text-align: left; }
    .question, #feedback { margin-bottom: 10px; font-size: 18px; text-align: left; }
    button { padding: 10px 20px; font-size: 16px; margin-right: 20px; }
  </style>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<h1>高次方程式の問題</h1>
<div class="question" id="question"></div>
<div style="margin-top: 20px;">
  <button type="button" onclick="showAnswer()">答え</button>
  <button type="button" onclick="generateQuestion()">再出題</button>
</div>
<div id="feedback" style="margin-top: 20px;"></div>
<script>
MathJax = { chtml: { displayAlign: "left", }
};
</script>


<script>
function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}
function getRandomElement(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}
function formatTerm(r, k) {
  if (k === 0) return r === 0 ? '' : (r > 0 ? `+${r}` : `${r}`);
  if (r === 0) return '';
  const xk = k === 1 ? 'x' : `x^${k}`;
  if (r === 1) return `+${xk}`;
  if (r === -1) return `-${xk}`;
  return r > 0 ? `+${r}${xk}` : `${r}${xk}`;
}

function generateQuestion() {
  const i = getRandomInt(1, 2);
  let j = getRandomInt(1, 6);
  let a1, a2, a3, a4, r0, r1, r2, r3;
  let questionText, correctAnswer;

  if (i === 1) {
    if (j === 1) {
      const values = [-4,-3,-2,-1,0,1,2,3,4].filter((v, i, a) => a.indexOf(v) === i);
      do {
        a1 = getRandomElement(values);
        a2 = getRandomElement(values);
        a3 = getRandomElement(values);
      } while (new Set([a1, a2, a3]).size < 3);
      r2 = -(a1 + a2 + a3);
      r1 = a1 * a2 + a2 * a3 + a3 * a1;
      r0 = -(a1 * a2 * a3);
      correctAnswer = `$$x=${a1}，${a2}，${a3}$$`;
    } else if (j === 2) {
      do { a1 = getRandomInt(-2, 2); } while (a1 === 0);
      a2 = getRandomElement([-5, -3, -1, 1, 3, 5]);
      a = getRandomElement([1,3,4,5,7,8]);
      a3 = 4 * a + 1;
      r0 = -a1 * (a2*a2 - a3)/4;
      r1 = (a2*a2 - a3)/4 - a2*a1;
      r2 = -a1 + a2;
      correctAnswer = `$$x=\\frac{${-a2} \\pm \\sqrt{${a3}}}{2},${a1}$$`;
    } else if (j === 3) {
      do { a1 = getRandomInt(-2, 2); } while (a1 === 0);
      a2 = getRandomElement([-5, -3, -1, 1, 3, 5]);
      a = getRandomInt(1, 5);
      a3 = 4 * a - 1;
      r0 = -a1 * (a2*a2 + a3)/4;
      r1 = (a2*a2 + a3)/4 - a2*a1;
      r2 = -a1 + a2;
      correctAnswer = `$$x=\\frac{${-a2} \\pm \\sqrt{${a3}}i}{2},${a1}$$`;
    } else if (j === 4) {
      do { a1 = getRandomInt(-2, 2); } while (a1 === 0);
      do { a2 = getRandomInt(-2, 2); } while (a2 === 0);
      a3 = getRandomElement([2,3,5,11,7,13]);
      r0 = -a1 * (a2*a2 - a3);
      r1 = (a2*a2 - a3) - 2*a2*a1;
      r2 = -a1 + 2*a2;
      correctAnswer = `$$x=${-a2} \\pm \\sqrt{${a3}},${a1}$$`;
    } else if (j === 5) {
      do { a1 = getRandomInt(-2, 2); } while (a1 === 0);
      do { a2 = getRandomInt(-2, 2); } while (a2 === 0);
      a3 = getRandomElement([2,3,5,11,7,13]);
      r0 = -a1 * (a2*a2 + a3);
      r1 = (a2*a2 + a3) - 2*a2*a1;
      r2 = -a1 + 2*a2;
      correctAnswer = `$$x=${-a2} \\pm \\sqrt{${a3}}i,${a1}$$`;
    } else if (j === 6) {
      const values = [-3,-2,-1,1,2,3];
      do {
        a1 = getRandomElement(values);
        a2 = getRandomElement(values);
      } while (a1 === a2);
      r0 = -a1*a1*a2;
      r1 = 2*a1*a2 - a1*a1;
      r2 = -(a2 + 2*a1);
      correctAnswer = `$$x=${a2},${a1}$$`;
    }
    const R2 = formatTerm(r2, 2);
    const R1 = formatTerm(r1, 1);
    const R0 = formatTerm(r0, 0);
    questionText = `$$方程式~x^3${R2}${R1}${R0}~を解け。$$`;
  } else if (i === 2) {
    j = getRandomInt(1, 3);
    if (j === 1) {
      a1 = getRandomInt(1, 3);
      r1 = r2 = r3 = 0;
      r0 = -Math.pow(a1, 4);
      correctAnswer = `$$x=\\pm${a1},\\pm${a1}i$$`;
    } else if (j === 2) {
      a1 = getRandomElement([2,3,5,7,10]);
      a2 = getRandomInt(1, 3);
      r0 = -a1*a2*a2;
      r1 = 0;
      r2 = -a1 + a2*a2;
      r3 = 0;
      correctAnswer = `$$x=\\pm \\sqrt{${a1}},\\pm${a2}i$$`;
    } else if (j === 3) {
      a1 = getRandomElement([2,3,5,7,10]);
      a2 = getRandomInt(1, 3);
      r0 = -a1*a2*a2;
      r1 = 0;
      r2 = a1 - a2*a2;
      r3 = 0;
      correctAnswer = `$$x=\\pm${a2},\\pm \\sqrt{${a1}}i$$`;
    }
    const R3 = formatTerm(r3, 3);
    const R2 = formatTerm(r2, 2);
    const R1 = formatTerm(r1, 1);
    const R0 = formatTerm(r0, 0);
    questionText = `$$方程式~x^4${R3}${R2}${R1}${R0}~を解け。$$`;
  }

  document.getElementById("question").innerHTML = questionText;
  document.getElementById("feedback").innerHTML = '';
  window.answerText = correctAnswer;
  MathJax.typeset();
}

function showAnswer() {
  document.getElementById("feedback").innerHTML = window.answerText;
  MathJax.typeset();
}

generateQuestion();
</script>
</body>
</html>
